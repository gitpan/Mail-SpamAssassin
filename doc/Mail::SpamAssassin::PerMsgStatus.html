<HTML>
<HEAD>
<TITLE>Mail::SpamAssassin::PerMsgStatus - per-message status</TITLE>
<LINK REV="made" HREF="mailto:bhcompile@stripples.devel.redhat.com">
</HEAD>

<BODY>

<A NAME="__index__"></A>
<!-- INDEX BEGIN -->

<UL>

	<LI><A HREF="#name">NAME</A></LI>
	<LI><A HREF="#synopsis">SYNOPSIS</A></LI>
	<LI><A HREF="#description">DESCRIPTION</A></LI>
	<LI><A HREF="#methods">METHODS</A></LI>
	<LI><A HREF="#see also">SEE ALSO</A></LI>
</UL>
<!-- INDEX END -->

<HR>
<P>
<H1><A NAME="name">NAME</A></H1>
<P>Mail::SpamAssassin::PerMsgStatus - per-message status (spam or not-spam)</P>
<P>
<HR>
<H1><A NAME="synopsis">SYNOPSIS</A></H1>
<PRE>
  my $spamtest = new Mail::SpamAssassin ({
    'rules_filename'      =&gt; '/etc/spamassassin.rules',
    'userprefs_filename'  =&gt; $ENV{HOME}.'/.spamassassin.cf'
  });
  my $mail = Mail::Audit-&gt;new();</PRE>
<PRE>
  my $status = $spamtest-&gt;check ($mail);
  if ($status-&gt;is_spam()) {
    $status-&gt;rewrite_mail ();
    $mail-&gt;accept(&quot;caught_spam&quot;);
  }
  ...</PRE>
<P>
<HR>
<H1><A NAME="description">DESCRIPTION</A></H1>
<P>The Mail::SpamAssassin <CODE>check()</CODE> method returns an object of this
class.  This object encapsulates all the per-message state.</P>
<P>
<HR>
<H1><A NAME="methods">METHODS</A></H1>
<DL>
<DT><STRONG><A NAME="item_is_spam">$isspam = $status-&gt;is_spam ()</A></STRONG><BR>
<DD>
After a mail message has been checked, this method can be called.  It will
return 1 for mail determined likely to be spam, 0 if it does not seem
spam-like.
<P></P>
<DT><STRONG><A NAME="item_get_names_of_tests_hit">$list = $status-&gt;get_names_of_tests_hit ()</A></STRONG><BR>
<DD>
After a mail message has been checked, this method can be called.  It will
return a comma-separated string, listing all the symbolic test names
of the tests which were trigged by the mail.
<P></P>
<DT><STRONG><A NAME="item_get_hits">$num = $status-&gt;get_hits ()</A></STRONG><BR>
<DD>
After a mail message has been checked, this method can be called.  It will
return the number of hits this message incurred.
<P></P>
<DT><STRONG><A NAME="item_get_required_hits">$num = $status-&gt;get_required_hits ()</A></STRONG><BR>
<DD>
After a mail message has been checked, this method can be called.  It will
return the number of hits required for a mail to be considered spam.
<P></P>
<DT><STRONG><A NAME="item_get_report">$report = $status-&gt;get_report ()</A></STRONG><BR>
<DD>
Deliver a ``spam report'' on the checked mail message.  This contains details of
how many spam detection rules it triggered.
<P>The report is returned as a multi-line string, with the lines separated by
<CODE>\n</CODE> characters.</P>
<P></P>
<DT><STRONG><A NAME="item_rewrite_mail">$status-&gt;rewrite_mail ()</A></STRONG><BR>
<DD>
Rewrite the mail message.  This will add headers, and possibly body text, to
reflect it's spam or not-spam status.
<P>The modifications made are as follows:</P>
<DL>
<DT><STRONG><A NAME="item_Subject%3A_header_for_spam_mails">Subject: header for spam mails</A></STRONG><BR>
<DD>
The string <CODE>*****SPAM*****</CODE> is prepended to the subject.
<P></P>
<DT><STRONG><A NAME="item_X%2DSpam%2DStatus%3A_header_for_spam_mails">X-Spam-Status: header for spam mails</A></STRONG><BR>
<DD>
A string, <CODE>Yes, hits=nn required=nn tests=...</CODE> is set in this header to
reflect the filter status.  The keys in this string are as follows:
<DL>
<DT><STRONG><A NAME="item_hits%3Dnn_The_number_of_hits_the_message_triggered">hits=nn The number of hits the message triggered.</A></STRONG><BR>
<DD>
<DT><STRONG><A NAME="item_required%3Dnn_The_threshold_at_which_a_mail_is_mar">required=nn The threshold at which a mail is marked as spam.</A></STRONG><BR>
<DD>
<DT><STRONG><A NAME="item_tests%3D%2E%2E%2E_The_symbolic_names_of_tests_whic">tests=... The symbolic names of tests which were triggered.</A></STRONG><BR>
<DD>
</DL>
<DT><STRONG><A NAME="item_X%2DSpam%2DFlag%3A_header_for_spam_mails">X-Spam-Flag: header for spam mails</A></STRONG><BR>
<DD>
Set to <CODE>YES</CODE>.
<P></P>
<DT><STRONG><A NAME="item_Content%2DType%3A_header_for_spam_mails">Content-Type: header for spam mails</A></STRONG><BR>
<DD>
Set to <CODE>text/plain</CODE>, in order to defang HTML mail or other active
content that could ``call back'' to the spammer.
<P></P>
<DT><STRONG><A NAME="item_spam_mail_body_text">spam mail body text</A></STRONG><BR>
<DD>
The SpamAssassin report is added to top of the mail message body.
<P></P>
<DT><STRONG><A NAME="item_X%2DSpam%2DStatus%3A_header_for_non%2Dspam_mails">X-Spam-Status: header for non-spam mails</A></STRONG><BR>
<DD>
A string, <CODE>No, hits=nn required=nn tests=...</CODE> is set in this header to reflect
the filter status.  The keys in this string are the same as for spam mails (see
above).
<P></P></DL>
<DT><STRONG><A NAME="item_handle_auto_report">$status-&gt;handle_auto_report ()</A></STRONG><BR>
<DD>
If this mail message has a high enough hit score, report it to spam-tracking
services straight away, without waiting for user confirmation.  See the
documentation for <CODE>spamassassin</CODE>'s <CODE>-r</CODE> switch for details on what
spam-tracking services are used.
<P></P>
<DT><STRONG><A NAME="item_finish">$status-&gt;finish ()</A></STRONG><BR>
<DD>
Indicate that this <CODE>$status</CODE> object is finished with, and can be destroyed.
<P>If you are using SpamAssassin in a persistent environment, or checking many
mail messages from one <A HREF="/Mail/SpamAssassin.html">the Mail::SpamAssassin manpage</A> factory, this method should be
called to ensure Perl's garbage collection will clean up old status objects.</P>
<P></P></DL>
<P>
<HR>
<H1><A NAME="see also">SEE ALSO</A></H1>
<P><CODE>Mail::SpamAssassin</CODE>
<CODE>spamassassin</CODE></P>

</BODY>

</HTML>
